version: "3"
services:
  web:
    platform: linux/x86_64
    image: nginx:latest
    container_name: nginx_web
    build:
      context: .
      dockerfile: Dockerfile.development
    ports:
      - 82:82 # local:docker
    volumes: # mount root directory from this machine to the container itself (live development, e.g. Rails sees changes to files without rebuilding container)
      - ./site/_site:/site # mount the Jekyll _site to the public page
      - ./config/nginx/default.conf:/etc/nginx/conf.d/default.conf
    stdin_open: true
    tty: true
    restart: unless-stopped
    depends_on:
      - sequenceserver
      - jbrowse
  sequenceserver:
    platform: linux/x86_64
    # image: wurmlab/sequenceserver:2.0.0.rc8  # was this
    build: 
      context: .
      dockerfile: Dockerfile.sequenceserver
    ports:
      - 8082 # :4567 # local url /127.0.0.1:8082
    tty: true # added 2021
#    stdin_open: true # added 2021
    volumes:
      - ./data/sequenceserver:/db
      - ./config/sequenceserver/sequenceserver.conf:/root/.sequenceserver.conf
      - ./config/sequenceserver/links.rb:/links.rb
      - ./config/sequenceserver/gage_metadata.rb:/gage_metadata.rb
  jbrowse:
    platform: linux/x86_64
    build:
      context: . # using a local Dockerfile
      dockerfile: Dockerfile.jbrowse
        #    ports:
        #      - "8081:80"
    env_file:
      - ./config/jbrowse/env.conf
    volumes:
      - ./config/jbrowse/jbrowse.conf:/conda/opt/jbrowse/jbrowse.conf # OK
      - ./data/jbrowse:/conda/opt/jbrowse/data
